<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>á‘á¶á‰á‘á·á“áŸ’á“á“áŸá™á–á¸ Firebase</title>
    <!-- 1. á”á“áŸ’ááŸ‚á˜ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 2. á”á“áŸ’ááŸ‚á˜ Firebase SDKs (Realtime Database) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <!-- 3. á”áŸ’áá¼ášá‘áŸ… Lucide (áŸá˜áŸ’ášá¶á”áŸ‹ Icons) -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <style>
        /* á”á“áŸ’ááŸ‚á˜á–á»á˜áŸ’á–á¢á€áŸ’áŸášááŸ’á˜áŸ‚áš (á”áŸ’ášáŸá·á“á”á¾ 'Inter' ášá”áŸáŸ‹ Tailwind á˜á·á“á”á„áŸ’á á¶á‰ááŸ’ášá¹á˜ááŸ’ášá¼áœ) */
        @import url('https://fonts.googleapis.com/css2?family=Kantumruy+Pro:wght@400;500;700&display=swap');
        
        body {
            /* á”áŸ’ášá¾ Inter á˜á»á“, á”á“áŸ’á‘á¶á”áŸ‹á˜á€ 'Kantumruy Pro' á‡á¶ fallback */
            font-family: 'Inter', 'Kantumruy Pro', sans-serif;
        }

        /* áŸá˜áŸ’ášá¶á”áŸ‹á›á¶á€áŸ‹ scrollbar ááŸ‚á“áŸ…ááŸ‚á¢á¶á… scroll á”á¶á“ */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }

        /* á€áŸ†áááŸ‹á‘áŸ†á áŸ† Icon á“áŸ…á€áŸ’á“á»á„ Card */
        .detail-icon {
            width: 16px;
            height: 16px;
            flex-shrink: 0; /* á€á¶ášá–á¶ášá€á»áŸ†á±áŸ’á™ Icon á’áŸ’á›á¶á€áŸ‹ */
        }
    </style>
</head>
<body class="bg-gray-800 min-h-screen flex items-center justify-center p-4">

    <!-- á€áŸ’ášá”ááŸááŸ’áŒá‘á¼ášáŸáŸá–áŸ’á‘ (Phone Frame) -->
    <div class="w-full max-w-sm bg-gray-100 rounded-2xl shadow-2xl overflow-hidden mx-auto flex flex-col" style="height: 85vh; min-height: 600px;">
        
        <!-- Header -->
        <div class="bg-gradient-to-r from-blue-600 to-indigo-700 p-5 shadow-md z-10">
            <h1 class="text-2xl font-bold text-white text-center">
                ğŸ“¦ á‘á·á“áŸ’á“á“áŸá™á“á·áŸáŸ’áŸá·á
            </h1>
        </div>

        <!-- á•áŸ’á‘áŸƒ Scrollable Content -->
        <div class="flex-1 overflow-y-auto no-scrollbar">
            
            <!-- Input Section (á”á¶á“á›á»á”) -->
            <!-- Status Message Area -->
            <div id="status-message" class="hidden p-4 mx-5 mt-4 rounded-md"></div>

            <!-- Output Section -->
            <div class="p-5">
                <label class="block text-sm font-medium text-gray-700 mb-3">
                    á›á‘áŸ’á’á•á› (Cards)
                </label>
                <!-- á€á“áŸ’á›áŸ‚á„á”á„áŸ’á á¶á‰ Card -->
                <div id="card-output-area" class="space-y-4">
                    <!-- Cards á“á¹á„ááŸ’ášá¼áœá”á¶á“á”á‰áŸ’á…á¼á›á˜á€á‘á¸á“áŸáŸ‡áŠáŸ„á™ JavaScript -->
                    <p id="initial-message" class="text-gray-400 text-center p-4">
                        áŸá¼á˜ášá„áŸ‹á…á¶áŸ†... á€áŸ†á–á»á„á‘á¶á‰á‘á·á“áŸ’á“á“áŸá™...
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ------------------------------------------------------------------
        // áŸ£. âš¡ï¸âš¡ï¸âš¡ï¸ á€á¶ášá€áŸ†áááŸ‹ášá…á“á¶áŸá˜áŸ’á–áŸá“áŸ’á’ Firebase âš¡ï¸âš¡ï¸âš¡ï¸
        // ------------------------------------------------------------------
        const firebaseConfig = {
            apiKey: "AIzaSyAc2g-t9A7du3K_nI2fJnw_OGxhmLfpP6s",
            authDomain: "dilistname.firebaseapp.com",
            databaseURL: "https://dilistname-default-rtdb.firebaseio.com",
            projectId: "dilistname",
            storageBucket: "dilistname.firebasestorage.app",
            messagingSenderId: "897983357871",
            appId: "1:897983357871:web:42a046bc9fb3e0543dc55a",
            measurementId: "G-NQ798D9J6K"
        };
        
        // áŸ¤. á•áŸ’áá½á…á•áŸ’áá¾á˜ (Initialize) Firebase
        let firebaseApp;
        let database;
        
        try {
            if (!firebase.apps.length) {
                firebaseApp = firebase.initializeApp(firebaseConfig);
                database = firebase.database();
            } else {
                firebaseApp = firebase.app();
                database = firebase.database();
            }
        } catch (error) {
            console.error("Firebase initialization error:", error);
            // We need showStatus to be defined to call it, but if init fails, we'll just log to console
            console.error(
                `âŒ á˜á¶á“á”á‰áŸ’á á¶á€áŸ’á“á»á„á€á¶ášá—áŸ’á‡á¶á”áŸ‹ FirebaseáŸ– ${error.message} áŸá¼á˜á–á·á“á·ááŸ’á™ Config ášá”áŸáŸ‹á¢áŸ’á“á€áŸ”`
            );
        }

        // áŸ¥. á˜á»áá„á¶ášáŸá˜áŸ’ášá¶á”áŸ‹á”á„áŸ’á á¶á‰ Status
        const statusEl = document.getElementById('status-message');
        const outputEl = document.getElementById('card-output-area');
        // const buttonEl = document.getElementById('fetch-button'); (á›á»á”á”áŸŠá¼áá»á„)
        const initialMessageEl = document.getElementById('initial-message');
        
        function showStatus(message, type = 'loading') {
            statusEl.classList.remove('hidden', 'bg-blue-100', 'text-blue-800', 'bg-red-100', 'text-red-800');
            
            if (type === 'loading') {
                statusEl.classList.add('bg-blue-100', 'text-blue-800');
                statusEl.textContent = `â³ ${message}`;
            } else if (type === 'error') {
                statusEl.classList.add('bg-red-100', 'text-red-800');
                statusEl.textContent = `âŒ ${message}`;
            }
            
            statusEl.classList.remove('hidden');
        }

        // áŸ¦. á˜á»áá„á¶ášááŸ’á˜á¸áŸ– á”á„áŸ’á€á¾á HTML áŸá˜áŸ’ášá¶á”áŸ‹ Card á“á·áŸáŸ’áŸá·á (ášá…á“á¶á”áááŸ’á˜á¸)
        
        /**
         * á˜á»áá„á¶ášá‡áŸ†á“á½á™áŸá˜áŸ’ášá¶á”áŸ‹á”á„áŸ’á€á¾áà¹à¸–à¸§á–áŸááŸŒá˜á¶á“á›á˜áŸ’á¢á·á (Detail Row) á‡á¶á˜á½á™ Icon
         * @param {string} icon - áˆáŸ’á˜áŸ„áŸ‡ Icon á–á¸ Lucide (á§. 'user', 'phone')
         * @param {string} label - áŸáŸ’á›á¶á€ (á§. 'á‡áŸ†á“á¶á‰')
         * @param {string} value - áá˜áŸ’á›áŸƒ (á§. 'á˜á·á“á˜á¶á“á‡áŸ†á“á¶á‰')
         */
        function createDetailRow(icon, label, value) {
            if (!value || String(value).trim() === '') { // á–á·á“á·ááŸ’á™áá˜áŸ’á›áŸƒ string á¬ number
                return ''; // á€á»áŸ†á”á„áŸ’á á¶á‰à¹à¸–à¸§ á”áŸ’ášáŸá·á“á”á¾áá˜áŸ’á›áŸƒá‘á‘áŸ
            }
            return `
                <div class="flex items-start space-x-3 text-sm text-gray-700">
                    <i data-lucide="${icon}" class="detail-icon text-indigo-600 mt-1"></i>
                    <div class="flex-1 break-words"> <!-- á”á“áŸ’ááŸ‚á˜ break-words -->
                        <span class="font-medium">${label}:</span>
                        <span class="text-gray-900">${value}</span>
                    </div>
                </div>
            `;
        }

        function createStudentCard(student) {
            // á‘á¶á‰á™á€á‘á·á“áŸ’á“á“áŸá™á‘á¶áŸ†á„á¢áŸáŸ‹ (á”áŸ’ášá¾ 'á˜á·á“á”á¶á“á”á‰áŸ’á‡á¶á€áŸ‹' á‡á¶ default)
            const name = student.áˆáŸ’á˜áŸ„áŸ‡ || 'á˜á·á“á˜á¶á“áˆáŸ’á˜áŸ„áŸ‡';
            const major = student.á‡áŸ†á“á¶á‰ || 'á˜á·á“á”á¶á“á”á‰áŸ’á‡á¶á€áŸ‹';
            const year = student.á†áŸ’á“á¶áŸ†áŸá·á€áŸ’áŸá¶ || 'N/A';
            const group = student.á‚áŸ’ášá»á” || 'N/A';
            const imageUrl = student.ášá¼á”áá || '';
            const link = student.ááŸ†áá—áŸ’á‡á¶á”áŸ‹ || '';
            const gender = student.á—áŸá‘ || 'á˜á·á“á”á¶á“á”á‰áŸ’á‡á¶á€áŸ‹';
            const dob = student.ááŸ’á„áŸƒááŸ‚á†áŸ’á“á¶áŸ†á€áŸ†áá¾á || 'á˜á·á“á”á¶á“á”á‰áŸ’á‡á¶á€áŸ‹';
            const pob = student.á‘á¸á€á“áŸ’á›áŸ‚á„á€áŸ†áá¾á || 'á˜á·á“á”á¶á“á”á‰áŸ’á‡á¶á€áŸ‹';
            const phone = student.á›áŸáá‘á¼ášáŸáŸá–áŸ’á‘ || 'á˜á·á“á”á¶á“á”á‰áŸ’á‡á¶á€áŸ‹';
            const studentId = student.á›áŸááŸá˜áŸ’á‚á¶á›áŸ‹ || 'N/A';
            
            // á”á¶á“á‡á½áŸá‡á»á›áŸ– á”á“áŸ’ááŸ‚á˜á¢ááŸáš (variables) áŠáŸ‚á›á”á¶ááŸ‹
            const email = student.á¢áŸŠá¸á˜áŸ‚á› || 'á˜á·á“á”á¶á“á”á‰áŸ’á‡á¶á€áŸ‹';
            const status = student.áŸáŸ’áá¶á“á—á¶á– || 'á˜á·á“á”á¶á“á”á‰áŸ’á‡á¶á€áŸ‹';
            
            const placeholderImg = `https://placehold.co/200x200/e2e8f0/94a3b8?text=${encodeURIComponent(name.charAt(0) || '?')}`;

            return `
                <div class="bg-white rounded-xl shadow-lg overflow-hidden transition-all hover:shadow-xl">
                    
                    <!-- á–áŸááŸŒá˜á¶á“á…á˜áŸ’á”á„ -->
                    <div class="p-5">
                        
                        <!-- ášá¼á”áá (ášá…á“á¶á”áááŸ’á˜á¸ - á˜á¼á›) -->
                        <div class="flex justify-center mb-4">
                            <img 
                                src="${imageUrl}" 
                                alt="ášá¼á”ááášá”áŸáŸ‹ ${name}" 
                                class="w-24 h-24 object-cover rounded-full border-4 border-indigo-100 shadow-lg"
                                onerror="this.onerror=null; this.src='${placeholderImg}';"
                            >
                        </div>
                        
                        <h3 class="text-2xl font-bold text-indigo-700 break-words text-center">${name}</h3>
                        <p class="text-md font-medium text-gray-600 mb-4 text-center">ID: ${studentId}</p>

                        <!-- á–áŸááŸŒá˜á¶á“á›á˜áŸ’á¢á·á -->
                        <div class="space-y-3">
                            ${createDetailRow('book-marked', 'á‡áŸ†á“á¶á‰', major)}
                            ${createDetailRow('calendar', 'á†áŸ’á“á¶áŸ†áŸá·á€áŸ’áŸá¶', year)}
                            ${createDetailRow('users', 'á‚áŸ’ášá»á”', group)}
                            ${createDetailRow('user-check', 'á—áŸá‘', gender)}
                            ${createDetailRow('gift', 'ááŸ’á„áŸƒááŸ‚á†áŸ’á“á¶áŸ†á€áŸ†áá¾á', dob)}
                            ${createDetailRow('map-pin', 'á‘á¸á€á“áŸ’á›áŸ‚á„á€áŸ†áá¾á', pob)}
                            ${createDetailRow('phone', 'á›áŸáá‘á¼ášáŸáŸá–áŸ’á‘', phone)}
                            ${createDetailRow('mail', 'á¢áŸŠá¸á˜áŸ‚á›', email)}
                            ${createDetailRow('info', 'áŸáŸ’áá¶á“á—á¶á–', status)}
                        </div>
                    </div>

                    <!-- á”áŸŠá¼áá»á„ááŸ†áá—áŸ’á‡á¶á”áŸ‹ (á”áŸ’ášáŸá·á“á”á¾á˜á¶á“) -->
                    ${link !== '' ? `
                    <div class="p-5 border-t border-gray-100 bg-gray-50">
                        <a 
                            href="${link}" 
                            target="_blank" 
                            class="flex items-center justify-center w-full text-center bg-indigo-600 text-white font-medium py-3 px-4 rounded-lg hover:bg-indigo-700 transition-colors"
                        >
                            <i data-lucide="send" class="w-4 h-4 mr-2"></i>
                            á˜á¾á›ááŸ†áá—áŸ’á‡á¶á”áŸ‹ (Telegram)
                        </a>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        // áŸ§. á˜á»áá„á¶ášà¸«à¸¥à¸±à¸áŸá˜áŸ’ášá¶á”áŸ‹á‘á¶á‰á‘á·á“áŸ’á“á“áŸá™ (á”á¶á“á‡á½áŸá‡á»á› - áŠá€á€á¶ášáŸáŸ’á‘á½á“á…áŸá‰)
        async function fetchFirebaseData() {
            if (!database) {
                showStatus('Firebase á˜á·á“á‘á¶á“áŸ‹á—áŸ’á‡á¶á”áŸ‹ášá½á…ášá¶á›áŸ‹á‘áŸáŸ” áŸá¼á˜á–á·á“á·ááŸ’á™ ConsoleáŸ”', 'error');
                return;
            }

            // á”á¶á“á›á»á” Input Box - á”áŸ’ášá¾ Path ááŸáš (Hard-coded)
            const path = "/students"; 
            
            // á”á¶á“á›á»á”á€á¶ášááŸ’ášá½áá–á·á“á·ááŸ’á™ Path
            
            // buttonEl.disabled = true; (á”á¶á“á›á»á”)
            // buttonEl.textContent = 'á€áŸ†á–á»á„á‘á¶á‰...'; (á”á¶á“á›á»á”)
            outputEl.innerHTML = ''; // áŸá˜áŸ’á¢á¶áá›á‘áŸ’á’á•á›á…á¶áŸáŸ‹
            if (initialMessageEl) {
                initialMessageEl.style.display = 'none'; // á›á¶á€áŸ‹áŸá¶ášá…á¶á”áŸ‹á•áŸ’áá¾á˜
            }
            showStatus(`á€áŸ†á–á»á„á‘á¶á‰á‘á·á“áŸ’á“á“áŸá™á–á¸ Path: ${path}`, 'loading');

            try {
                const dbRef = database.ref(path);
                const snapshot = await dbRef.once('value');
                
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    
                    // á–á·á“á·ááŸ’á™á˜á¾á›áá¶áá¾ data á‡á¶ Object á¬ Array
                    if (typeof data === 'object' && data !== null) {
                        // á”áŸ†á”áŸ’á›áŸ‚á„ Object á‘áŸ…á‡á¶ Array
                        const dataArray = Object.values(data);
                        
                        // á”á„áŸ’á€á¾á Card áŸá˜áŸ’ášá¶á”áŸ‹á’á¶áá»á“á¸á˜á½á™áŸ—
                        dataArray.forEach(item => {
                            if (typeof item === 'object' && item !== null) {
                                outputEl.innerHTML += createStudentCard(item);
                            }
                        });

                        // â—ï¸ áŸáŸ†áá¶á“áŸ‹áŸ– á áŸ… Lucide áŠá¾á˜áŸ’á”á¸á”á„áŸ’á€á¾á Icons
                        lucide.createIcons();
                        
                        statusEl.classList.add('hidden'); // á›á¶á€áŸ‹ Status á”á¾á‡áŸ„á‚á‡áŸá™
                        
                        if (dataArray.length === 0) {
                            outputEl.innerHTML = '<p class="text-gray-500 text-center p-4">á˜á·á“á˜á¶á“á‘á·á“áŸ’á“á“áŸá™áŸá˜áŸ’ášá¶á”áŸ‹á”á„áŸ’á á¶á‰á‘áŸáŸ”</p>';
                        }

                    } else {
                        // á”áŸ’ášáŸá·á“á”á¾á‘á·á“áŸ’á“á“áŸá™á˜á·á“á˜áŸ‚á“á‡á¶ Object (á§. á‚áŸ’ášá¶á“áŸ‹ááŸ‚á‡á¶ String á¬ Number)
                        outputEl.innerHTML = `<div class="bg-white p-4 rounded-md shadow-sm">
                            <pre class="text-sm">${JSON.stringify(data, null, 2)}</pre>
                        </div>`;
                        statusEl.classList.add('hidden');
                    }
                    
                } else {
                    outputEl.innerHTML = `<p class="text-gray-500 text-center p-4">á˜á·á“á˜á¶á“á‘á·á“áŸ’á“á“áŸá™á“áŸ… Path: "${path}"</p>`;
                    if (initialMessageEl) {
                        initialMessageEl.style.display = 'block'; // á”á„áŸ’á á¶á‰áŸá¶ášáŠá¾á˜áœá·á‰á”á¾ error
                    }
                    showStatus(`á˜á·á“á˜á¶á“á‘á·á“áŸ’á“á“áŸá™ááŸ’ášá¼áœá”á¶á“ášá€áƒá¾á‰á“áŸ… "${path}"`, 'error');
                }
                
            } catch (error) {
                console.error("Firebase fetch error:", error);
                outputEl.innerHTML = `<p class="text-red-600 text-center p-4">Error: ${error.message}</p>`;
                if (initialMessageEl) {
                    initialMessageEl.style.display = 'block'; // á”á„áŸ’á á¶á‰áŸá¶ášáŠá¾á˜áœá·á‰á”á¾ error
                }
                showStatus(
                    `á˜á¶á“á”á‰áŸ’á á¶á€áŸ’á“á»á„á€á¶ášá‘á¶á‰á‘á·á“áŸ’á“á“áŸá™áŸ– ${error.message} ` + 
                    `(áŸá¼á˜á–á·á“á·ááŸ’á™á…áŸ’á”á¶á”áŸ‹ Security Rules ášá”áŸáŸ‹á¢áŸ’á“á€)`, 
                    'error'
                );
            } finally {
                // buttonEl.disabled = false; (á”á¶á“á›á»á”)
                // buttonEl.textContent = 'á‘á¶á‰á‘á·á“áŸ’á“á“áŸá™'; (á”á¶á“á›á»á”)
            }
        }

        // áŸ¨. á…á¶á”áŸ‹á•áŸ’áá¾á˜á‘á¶á‰á‘á·á“áŸ’á“á“áŸá™áŠáŸ„á™áŸáŸ’áœáŸá™á”áŸ’ášáœááŸ’áá·
        // ášá„áŸ‹á…á¶áŸ†á±áŸ’á™ DOM ááŸ’ášáŸ€á˜ášá½á…ášá¶á›áŸ‹
        document.addEventListener('DOMContentLoaded', () => {
            fetchFirebaseData();
        });
    </script>

</body>
</html>

